<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="shortcut icon" href="#" />
<script src="/javascripts/vue.js"></script>
<script src="/javascripts/jquery-3.2.1.min.js"></script>
<link rel="stylesheet" href="http://at.alicdn.com/t/font_753288_4s35ojdy9ic.css">
<link rel="stylesheet" href="/stylesheets/apitool.css">
<title></title>
<script>
$(function(){
    $("#lib").on("mouseenter", function(){
      $(this).find("ul").show()
    })
    $("#lib ul").on("mouseleave", function(){
      $(this).hide()
    })

    // 点击跳转url
    $("#lib ul li").on("click",function(){
      var url = $(this).data("url")
      window.location.href = url
    })
})
</script>
</head>
<body>
<!-- 头部 -->
<div class="header">
  <div class="logo"><img src="/images/logo.png"></div>
  <div class="menu">
    <a href="/admin">首页</a>
    <a href="javascript:;" class="dropdown-lib" id="lib">
      <span>文档<i class="iconfont icon-jiantou32"></i></span>
      <ul>
        <li data-url="/article/list_article.html"><i class="iconfont icon-document"></i>智慧城市移动系统API</li>
        <li data-url="/article/list_article.html"><i class="iconfont icon-document"></i>招商数字金融系统API</li>
      </ul>
    </a>
    <a href="#">目录</a>
    <a href="#">退出</a>
  </div>
</div>
<!-- //头部 -->
<div id="apitool">
  <!-- 工具栏 -->
  <div class="list-bar">
    <div class="list-name">
      <span>陈键锋</span>
      <em>/</em>
      <span>智慧城市移动系统（SCM）Api</span>
    </div>
    <div class="list-opt">
      <a href="/article/add_article.html" class="publish"> 新建文档 </a>
    </div>
  </div>
  <!-- //工具栏 -->
  <!-- 组件 -->
  <btn-comp></btn-comp>
  <!-- //组件 -->
  <!-- 列表 -->
  <div class="ad-container" v-cloak>
    <div class="ad-list" >
      <table width="100%" border="0" cellspacing="0" cellpadding="0" id="docList" class="table">
        <tr>
          <th width="20%">标题</th>
          <th width="50%">内容</th>
          <th width="10%">创建者</th>
          <th width="10%">创建时间</th>
          <th>操作</th>
        </tr>
        <tr v-for="(article, index) in articles">
          <td><a :href="'/article/view_article.html?id=' + article._id">{{ article.title }}</a></td>
          <td>{{ article.content }}</td>
          <td>cjf</td>
          <td>20180618</td>
          <td>
            <a href="javascript:;"  @click="confirm(index)">删除</a>&nbsp;&nbsp;
            <a :href="'/article/edit_article.html?id=' + article._id">修改</a>
          </td>
        </tr>
      </table>
    </div>

  </div>
  <!-- //列表 -->
  <!-- 删除 -->
  <div v-if="dialog">
    <div class="mask"></div>
    <div class="dialog">
      <div class="dialog-body info-del"> <i class="iconfont icon-wenhao"></i> <span>确认删除此文章？</span></div>
      <div class="dialog-footer">
        <button class="btn" @click="cancel">取消</button>
        <button class="btn primary"  @click="artDel(idx)">确定</button>
      </div>
    </div>
  </div>
  <!-- //删除 -->

</div>
<script src="/javascripts/header.js" charset="utf-8"></script>
<script type="text/javascript">
// vue实例
var app = new Vue({
  el: '#apitool',
  components: {
    btnComp: ButtonComp
  },
  data: {
    articles: [],
    dialog: false,
    idx: 0
  },
  created: function(){
    var _this = this;
    // 获取列表
    $.ajax({
			type: "get",
			url: "./list",
			dataType: "json",
			success: function(res){
        _this.articles = res;
			}
	  })
	},
  methods:{
    //删除确认
    confirm: function(idx){
      this.dialog = true
      this.idx = idx
    },

    //删除文章
    artDel: function(idx){
      var _this = this;
      $.ajax({
        type: 'post',
        url: './del',
        data:{
          id : _this.articles[_this.idx]._id
        },
        dataType: 'json',
        success: function(res){
          _this.articles.splice(_this.idx, 1)
          _this.dialog = false
        }
      })
    },

    //取消
    cancel: function(){
      this.dialog = false
    },
  }
})
</script>

</body>
</html>
